(()=>{"use strict";const e=window.wp.blocks,l=window.wp.i18n,i=window.wp.blockEditor,t=window.wp.components,a=window.wp.data,o=window.wp.coreData,s=window.ReactJSXRuntime;(0,e.registerBlockType)("mso/gallery",{title:(0,l.__)("MSO Gallery","mso-gallery"),icon:"format-gallery",category:"media",attributes:{ids:{type:"array",default:[]}},edit:e=>{const{attributes:r,setAttributes:n}=e,{ids:d}=r,{media:c,isLoading:p}=(0,a.useSelect)((e=>{const{getEntityRecords:l,hasFinishedResolution:i}=e(o.store);if(!(d&&d.length>0))return{media:[],isLoading:!1};const t={include:d,per_page:-1,orderby:"include",_embed:!0},a=["postType","attachment",t];return{media:l("postType","attachment",t),isLoading:!i("getEntityRecords",a)}}),[d]),g=e=>{const l=e.map((e=>e.id));n({ids:l})},y=d.length>0;return(0,s.jsxs)("div",{children:[(0,s.jsx)(i.InspectorControls,{children:(0,s.jsxs)(t.PanelBody,{title:(0,l.__)("Gallery Settings","mso-gallery"),children:[(0,s.jsx)("p",{children:(0,l.__)("Select images for your gallery.","mso-gallery")}),(0,s.jsx)(i.MediaUpload,{onSelect:g,allowedTypes:["image"],multiple:!0,gallery:!0,value:d,render:({open:e})=>(0,s.jsx)(t.Button,{isPrimary:!0,onClick:e,children:y?(0,l.__)("Edit Gallery","mso-gallery"):(0,l.__)("Create Gallery","mso-gallery")})})]})}),(0,s.jsx)(i.BlockControls,{children:(0,s.jsx)(t.ToolbarGroup,{children:(0,s.jsx)(i.MediaUpload,{onSelect:g,allowedTypes:["image"],multiple:!0,gallery:!0,value:d,render:({open:e})=>(0,s.jsx)(t.ToolbarButton,{icon:"edit",label:(0,l.__)("Edit Gallery","mso-gallery"),onClick:e})})})}),!y&&(0,s.jsx)(i.MediaPlaceholder,{icon:"format-gallery",labels:{title:(0,l.__)("MSO Gallery","mso-gallery"),instructions:(0,l.__)("Create your gallery by selecting images.","mso-gallery")},onSelect:g,allowedTypes:["image"],multiple:!0}),y&&(0,s.jsxs)("div",{className:"mso-gallery-preview",style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"10px"},children:[p&&(0,s.jsx)(t.Spinner,{}),!p&&c&&c.length>0&&c.map((e=>{const i=e._embedded?.["wp:featuredmedia"]?.[0]?.media_details?.sizes?.thumbnail?.source_url||e.media_details?.sizes?.thumbnail?.source_url||e.source_url;return(0,s.jsxs)("div",{style:{position:"relative",border:"1px solid #ddd"},children:[i?(0,s.jsx)("img",{src:i,alt:e.alt_text||"",style:{maxWidth:"100px",height:"auto",display:"block"}}):(0,s.jsxs)("span",{style:{display:"inline-block",padding:"10px",background:"#eee",fontSize:"10px"},children:[(0,l.__)("Loading...","mso-gallery")," ID: ",e.id]}),(0,s.jsx)(t.Button,{icon:"no-alt",label:(0,l.__)("Remove image","mso-gallery"),onClick:()=>(e=>{const l=d.filter((l=>l!==e));n({ids:l})})(e.id),isDestructive:!0,style:{position:"absolute",top:"-8px",right:"-8px",background:"white",borderRadius:"50%",padding:"0",minWidth:"18px",height:"18px",boxShadow:"0 0 2px rgba(0,0,0,0.5)"}})]},e.id)})),!p&&(!c||0===c.length)&&(0,s.jsx)("p",{children:(0,l.__)("Could not load image previews. Check browser console or REST API availability.","mso-gallery")})]})]})},save:()=>null})})();