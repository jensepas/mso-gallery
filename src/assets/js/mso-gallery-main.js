!function(e){"use strict";const a={overlay:null,container:null,image:null,caption:null,prev:null,next:null,close:null,loader:null,cache:null},t={activeGalleryInstance:null,currentIndex:-1,preloadedImages:{},totalImagesLoaded:{},isOverlayVisible:!1,animationDuration:300};class n{constructor(a,n,l){this.element=e(a),this.galleryId=n,this.images=l||[],this.config={animationDuration:t.animationDuration},t.preloadedImages[this.galleryId]=[],t.totalImagesLoaded[this.galleryId]=0,this.init()}init(){this.generateThumbnails(),this.preloadImages()}generateThumbnails(){this.images.forEach(((a,t)=>{e("<img>",{src:a.src,alt:a.alt||"",class:"thumbnail","data-index":t}).on("click",(()=>this.activateAndShowFullscreen(t))).appendTo(this.element)}))}preloadImages(){if(!this.images.length)return;a.loader?.show();const n=()=>{t.totalImagesLoaded[this.galleryId]++,Object.values(t.totalImagesLoaded).every(((e,a)=>{const n=Object.keys(t.totalImagesLoaded)[a];return e===(t.preloadedImages[n]?.length||0)}))&&a.loader?.hide()};this.images.forEach(((l,i)=>{const o=new Image;e(o).on("load error",n),o.src=l.full,o.alt=l.alt||"",t.preloadedImages[this.galleryId][i]=o,a.cache?.append(o)}))}activateAndShowFullscreen(e){e<0||e>=this.images.length||(t.activeGalleryInstance=this,t.currentIndex=e,l(),a.overlay&&a.container&&(a.container.attr("class","slide-out"),a.overlay.show().addClass("visible"),t.isOverlayVisible=!0,a.container[0].offsetHeight,a.container.attr("class","slide-in")))}}function l(){const e=t.activeGalleryInstance,n=t.currentIndex;if(!e||n<0||n>=e.images.length)return;const l=t.preloadedImages[e.galleryId]?.[n],i=e.images[n],o=l?.src||i?.full,r=l?.alt||i?.alt||"";a.image?.attr({src:o||"",alt:r}),a.caption?.text(r||"Aucune description disponible"),function(){const e=t.activeGalleryInstance,n=!e||e.images.length<=1;a.prev?.prop("disabled",n),a.next?.prop("disabled",n)}()}function i(){a.overlay&&a.container&&t.isOverlayVisible&&(a.container.attr("class","slide-out"),setTimeout((()=>{a.overlay.removeClass("visible").hide(),t.currentIndex=-1,t.activeGalleryInstance=null,t.isOverlayVisible=!1}),t.animationDuration))}function o(e){e?.stopPropagation();const n=t.activeGalleryInstance;if(!n||n.images.length<=1||!t.isOverlayVisible)return;const{container:i}=a,{animationDuration:o}=t;i.attr("class","slide-out-left"),setTimeout((()=>{t.currentIndex=(t.currentIndex-1+n.images.length)%n.images.length,l(),i.attr("class","slide-in-from-right")}),o)}function r(e){e?.stopPropagation();const n=t.activeGalleryInstance;if(!n||n.images.length<=1||!t.isOverlayVisible)return;const{container:i}=a,{animationDuration:o}=t;i.attr("class","slide-out-right"),setTimeout((()=>{t.currentIndex=(t.currentIndex+1)%n.images.length,l(),i.attr("class","slide-in-from-left")}),o)}function s(e){if(t.isOverlayVisible)switch(e.key){case"ArrowLeft":o();break;case"ArrowRight":r();break;case"Escape":i()}}e(document).ready((function(){if(a.overlay=e("#fullscreen-overlay"),a.container=e("#image-container"),a.image=e("#fullscreen-image"),a.caption=e("#image-caption"),a.prev=e("#prev-btn"),a.next=e("#next-btn"),a.close=e("#close-btn"),a.loader=e("#loading-indicator"),a.cache=e("#preload-cache"),!a.overlay.length||!a.container.length)return void console.warn("MSO Gallery: Fullscreen overlay elements not found. Aborting initialization.");if(a.overlay&&(a.prev?.on("click",o),a.next?.on("click",r),a.close?.on("click",i),a.overlay.on("click",(e=>{e.target===e.currentTarget&&i()})),e(document).on("keydown",s)),void 0===window.MSO_GALLERIES_DATA||e.isEmptyObject(window.MSO_GALLERIES_DATA))return void console.log("MSO Gallery: No gallery data found.");const t=[];e(".mso-gallery-thumbnails").each((function(){const a=e(this).data("gallery-id"),l=window.MSO_GALLERIES_DATA[a];a&&l?t.push(new n(this,a,l)):console.warn(`MSO Gallery: Data not found for gallery container with ID: ${a||"(not set)"}`)})),window.msoGalleryInstances=t,console.log(`MSO Gallery: Initialized ${t.length} galleries.`)}))}(jQuery);